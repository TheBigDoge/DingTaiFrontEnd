import{n as e,l as t,m as s,h as a,e as l,r as d,o as i,g as o,$ as r,p as n,i as u,d as c,c as m,q as f,t as h}from"./index-Clh3_Y42.js";import{a6 as _,ac as p,a7 as y,N as g,_ as v,aV as F,aO as b,al as k,ai as x,aW as A}from"./vendor.BqSpu6Cs.js";import{_ as O}from"./_plugin-vue_export-helper.BCo6x5W8.js";const C=O({data:()=>({address:{name:"张三",phone:"138****8888",detail:"北京市朝阳区三里屯SOHO 2号楼 2层"},orderItems:[],deliveryMethod:"快递配送",orderNote:"",shippingFee:0}),computed:{totalAmount(){return this.orderItems.reduce(((e,t)=>e+t.unitPrice*t.length),0)},discount(){return.1*this.totalAmount},finalAmount(){return this.totalAmount-this.discount+this.shippingFee}},onLoad(e){try{const e=a("currentOrder");e&&(this.orderItems=e.items)}catch(t){console.error("加载订单数据失败:",t),o({title:"加载订单失败",icon:"error"})}},onShow(){n("addressSelected",(e=>{this.address=e}))},onHide(){r("addressSelected")},methods:{changeAddress(){o({title:"更换地址功能开发中...",icon:"none"})},updateQuantity(e,t){const s=this.orderItems[e],a=parseFloat((s.length+t).toFixed(1));a>=.5&&(s.length=a)},selectDelivery(e){this.deliveryMethod=e},submitOrder(){0!==this.orderItems.length?(this.orderItems,this.address,this.orderNote,this.deliveryMethod,this.totalAmount,this.discount,this.finalAmount,(new Date).toISOString(),t({title:"提交中..."}),setTimeout((()=>{s(),o({title:"下单成功",icon:"success",duration:2e3,success:()=>{setTimeout((()=>{this.handleSubmitOrder()}),1500)}})}),1500)):o({title:"请选择商品",icon:"none"})},handleSubmitOrder(){t({title:"提交订单中..."}),setTimeout((()=>{s();const e=a("cartList")||[],t=a("currentOrder").items.map((e=>e.id)),o=e.filter((e=>!t.includes(e.id)));l("cartList",o),d("currentOrder"),i({url:"/pages/order/success"})}),1500)},goToAddress(){e({url:"/pages/address/address"})}}},[["render",function(e,t,s,a,l,d){const i=c,o=u,r=m,n=f,O=h;return y(),_(o,{class:"order-page"},{default:p((()=>[g(o,{class:"header"},{default:p((()=>[g(i,{class:"header-title"},{default:p((()=>[v("确认订单")])),_:1})])),_:1}),g(o,{class:"address-section",onClick:d.changeAddress},{default:p((()=>[g(o,{class:"address-info"},{default:p((()=>[g(o,{class:"address-name"},{default:p((()=>[v(F(l.address.name)+" "+F(l.address.phone),1)])),_:1}),g(o,{class:"address-detail"},{default:p((()=>[v(F(l.address.detail),1)])),_:1})])),_:1}),g(o,{class:"change-address"},{default:p((()=>[v("更换地址")])),_:1})])),_:1},8,["onClick"]),g(o,{class:"items-section"},{default:p((()=>[(y(!0),b(k,null,x(l.orderItems,((e,t)=>(y(),_(o,{class:"item",key:t},{default:p((()=>[g(r,{src:e.image,mode:"aspectFill",class:"item-image"},null,8,["src"]),g(o,{class:"item-info"},{default:p((()=>[g(o,{class:"item-title"},{default:p((()=>[v(F(e.name),1)])),_:2},1024),g(o,{class:"item-price"},{default:p((()=>[g(i,{class:"member-price"},{default:p((()=>[v("会员价：¥"+F((.9*e.unitPrice).toFixed(2)),1)])),_:2},1024),g(i,{class:"original-price"},{default:p((()=>[v("¥"+F(e.unitPrice.toFixed(2)),1)])),_:2},1024)])),_:2},1024),g(o,{class:"item-size"},{default:p((()=>[v("规格："+F(e.length)+"米",1)])),_:2},1024),g(o,{class:"quantity-control"},{default:p((()=>[g(i,{class:"quantity-btn",onClick:e=>d.updateQuantity(t,-.1)},{default:p((()=>[v("-")])),_:2},1032,["onClick"]),g(i,{class:"quantity"},{default:p((()=>[v(F(e.length),1)])),_:2},1024),g(i,{class:"quantity-btn",onClick:e=>d.updateQuantity(t,.1)},{default:p((()=>[v("+")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),g(o,{class:"delivery-section"},{default:p((()=>[g(o,{class:"section-title"},{default:p((()=>[v("配送方式")])),_:1}),g(o,{class:"delivery-options"},{default:p((()=>[g(o,{class:A(["delivery-option",{selected:"快递配送"===l.deliveryMethod}]),onClick:t[0]||(t[0]=e=>d.selectDelivery("快递配送"))},{default:p((()=>[v("快递配送")])),_:1},8,["class"]),g(o,{class:A(["delivery-option",{selected:"到店自提"===l.deliveryMethod}]),onClick:t[1]||(t[1]=e=>d.selectDelivery("到店自提"))},{default:p((()=>[v("到店自提")])),_:1},8,["class"])])),_:1})])),_:1}),g(o,{class:"memo-section"},{default:p((()=>[g(o,{class:"section-title"},{default:p((()=>[v("商品备注")])),_:1}),g(n,{class:"memo-input",modelValue:l.orderNote,"onUpdate:modelValue":t[2]||(t[2]=e=>l.orderNote=e),placeholder:"请输入备注信息（选填）",maxlength:"200","show-count":!1},null,8,["modelValue"]),g(o,{class:"memo-count"},{default:p((()=>[v(F(l.orderNote.length)+"/200",1)])),_:1})])),_:1}),g(o,{class:"bottom-container"},{default:p((()=>[g(o,{class:"order-summary"},{default:p((()=>[g(o,{class:"summary-item"},{default:p((()=>[g(i,null,{default:p((()=>[v("商品总额")])),_:1}),g(i,null,{default:p((()=>[v("¥"+F(d.totalAmount.toFixed(2)),1)])),_:1})])),_:1}),g(o,{class:"summary-item"},{default:p((()=>[g(i,null,{default:p((()=>[v("运费")])),_:1}),g(i,null,{default:p((()=>[v("¥"+F(l.shippingFee.toFixed(2)),1)])),_:1})])),_:1}),g(o,{class:"summary-item"},{default:p((()=>[g(i,null,{default:p((()=>[v("会员优惠")])),_:1}),g(i,null,{default:p((()=>[v("-¥"+F(d.discount.toFixed(2)),1)])),_:1})])),_:1}),g(o,{class:"summary-total"},{default:p((()=>[g(i,null,{default:p((()=>[v("实付金额")])),_:1}),g(i,null,{default:p((()=>[v("¥"+F(d.finalAmount.toFixed(2)),1)])),_:1})])),_:1}),g(o,{class:"discount-notice"},{default:p((()=>[v("会员享受9折优惠")])),_:1})])),_:1}),g(O,{class:"submit-btn safe-area-bottom",onClick:d.submitOrder},{default:p((()=>[v("提交订单")])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-4752462d"]]);export{C as default};
