import{c as e,w as t,m as s,p as a,q as l,a as c,n as i,u as o,i as n,o as r,b as d,f as u,d as h,e as g,t as f,g as m,F as _,h as p,v as L,j as k}from"./index-Dz1Oxr08.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const M=C({data:()=>({isManageMode:!1,cartList:[]}),computed:{isAllSelected(){return this.cartList.length>0&&this.cartList.every((e=>e.selected))},selectedCount(){return this.cartList.filter((e=>e.selected)).length},totalPrice(){return this.cartList.filter((e=>e.selected)).reduce(((e,t)=>e+t.unitPrice*t.length*.9),0).toFixed(2)},discount(){const e=parseFloat(this.totalPrice);return e>=200?30*Math.floor(e/200):0}},onShow(){const e=o("cartList")||[];this.cartList=e.map((e=>({...e,selected:!1})))},methods:{toggleSelect(e){this.cartList[e].selected=!this.cartList[e].selected,this.saveCartList()},toggleSelectAll(){const e=!this.isAllSelected;this.cartList.forEach((t=>t.selected=e)),this.saveCartList()},decreaseLength(e){const t=this.cartList[e];t.length>.85?(t.length=parseFloat((t.length-.1).toFixed(1)),this.saveCartList()):a({title:"提示",content:"确定要删除该商品吗？",success:t=>{t.confirm&&(this.cartList.splice(e,1),this.saveCartList())}})},increaseLength(e){const t=this.cartList[e];t.length=parseFloat((t.length+.1).toFixed(1)),this.saveCartList()},handleCheckout(){const e=this.cartList.filter((e=>e.selected));if(0===e.length)return void l({title:"请选择要结算的商品",icon:"none"});const t={items:e.map((e=>({id:e.id,name:e.name,image:e.image,color:e.color,length:e.length,unitPrice:e.unitPrice,subtotal:e.length*e.unitPrice}))),totalAmount:e.reduce(((e,t)=>e+t.length*t.unitPrice),0),discount:this.discount,finalAmount:e.reduce(((e,t)=>e+t.length*t.unitPrice),0)-this.discount};try{s("currentOrder",t),i({url:"/pages/order/order",success:()=>{console.log("Navigation successful")},fail:e=>{console.error("Navigation failed:",e),l({title:"页面跳转失败",icon:"error"})}})}catch(a){console.error("处理订单失败:",a),l({title:"处理订单失败，请重试",icon:"error"})}},goShopping(){c({url:"/pages/index/index"})},toggleManageMode(){this.isManageMode=!this.isManageMode,this.isManageMode||(this.cartList.forEach((e=>e.selected=!1)),this.saveCartList())},handleDeleteSelected(){const e=this.cartList.filter((e=>e.selected));0!==e.length?a({title:"提示",content:`确定要删除选中的${e.length}件商品吗？`,success:e=>{e.confirm&&(this.cartList=this.cartList.filter((e=>!e.selected)),this.saveCartList(),0===this.cartList.length&&(this.isManageMode=!1))}}):l({title:"请选择要删除的商品",icon:"none"})},handleDeleteItem(e){a({title:"提示",content:"确定要删除该商品吗？",success:t=>{t.confirm&&(this.cartList.splice(e,1),this.saveCartList(),0===this.cartList.length&&(this.isManageMode=!1))}})},saveCartList(){s("cartList",this.cartList)}}},[["render",function(s,a,l,c,i,o){const C=g,M=n,v=L,y=k;return r(),e(M,{class:"cart-page"},{default:t((()=>[d(M,{class:"page-header"},{default:t((()=>[d(M,{class:"header-title"},{default:t((()=>[u(" 购物车"),i.cartList.length>0?(r(),e(C,{key:0},{default:t((()=>[u("("+f(i.cartList.length)+")",1)])),_:1})):h("",!0)])),_:1}),d(M,{class:"header-right"},{default:t((()=>[d(C,{class:"manage-text",onClick:o.toggleManageMode},{default:t((()=>[u(f(i.isManageMode?"退出管理":"管理"),1)])),_:1},8,["onClick"])])),_:1})])),_:1}),i.cartList.length>0?(r(),e(M,{key:0,class:"cart-content"},{default:t((()=>[d(M,{class:"cart-list"},{default:t((()=>[(r(!0),m(_,null,p(i.cartList,((s,a)=>(r(),e(M,{class:"cart-item",key:a},{default:t((()=>[d(M,{class:"item-select"},{default:t((()=>[d(v,{checked:s.selected,color:"#333",onClick:e=>o.toggleSelect(a)},null,8,["checked","onClick"])])),_:2},1024),d(y,{class:"item-image",src:s.image,mode:"aspectFill"},null,8,["src"]),d(M,{class:"item-info"},{default:t((()=>[d(M,{class:"item-name text-ellipsis-2"},{default:t((()=>[u(f(s.name),1)])),_:2},1024),s.color?(r(),e(M,{key:0,class:"item-spec"},{default:t((()=>[u("颜色："+f(s.color),1)])),_:2},1024)):h("",!0),d(M,{class:"item-bottom"},{default:t((()=>[d(M,{class:"item-price"},{default:t((()=>[d(C,{class:"member-price"},{default:t((()=>[u("¥"+f((.9*s.unitPrice).toFixed(2))+"/m",1)])),_:2},1024),d(C,{class:"original-price"},{default:t((()=>[u("¥"+f(s.unitPrice)+"/m",1)])),_:2},1024)])),_:2},1024),d(M,{class:"item-count"},{default:t((()=>[d(C,{class:"count-btn",onClick:e=>o.decreaseLength(a)},{default:t((()=>[u("-")])),_:2},1032,["onClick"]),d(C,{class:"count-num"},{default:t((()=>[u(f(s.length),1)])),_:2},1024),d(C,{class:"count-btn",onClick:e=>o.increaseLength(a)},{default:t((()=>[u("+")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024),i.isManageMode?(r(),e(M,{key:0,class:"delete-icon",onClick:e=>o.handleDeleteItem(a)},{default:t((()=>[d(C,{class:"iconfont icon-delete"},{default:t((()=>[u("×")])),_:1})])),_:2},1032,["onClick"])):h("",!0)])),_:2},1024)))),128))])),_:1}),d(M,{class:"promotion-section"},{default:t((()=>[d(M,{class:"promotion-item"},{default:t((()=>[d(C,{class:"tag"},{default:t((()=>[u("满减")])),_:1}),d(C,{class:"promo-text"},{default:t((()=>[u("每200减30")])),_:1})])),_:1})])),_:1}),d(M,{class:"cart-footer safe-area-bottom"},{default:t((()=>[d(M,{class:"footer-left"},{default:t((()=>[d(v,{checked:o.isAllSelected,color:"#333",onClick:o.toggleSelectAll},null,8,["checked","onClick"]),d(C,{class:"select-all"},{default:t((()=>[u("全选")])),_:1})])),_:1}),d(M,{class:"footer-right"},{default:t((()=>[i.isManageMode?(r(),e(M,{key:0,class:"delete-btn",onClick:o.handleDeleteSelected},{default:t((()=>[u("删除")])),_:1},8,["onClick"])):(r(),m(_,{key:1},[d(M,{class:"price-section"},{default:t((()=>[d(M,{class:"total-price"},{default:t((()=>[d(C,null,{default:t((()=>[u("合计：")])),_:1}),d(C,{class:"price"},{default:t((()=>[u("¥"+f(o.totalPrice),1)])),_:1})])),_:1}),o.discount>0?(r(),e(M,{key:0,class:"discount-info"},{default:t((()=>[u("已优惠：¥"+f(o.discount),1)])),_:1})):h("",!0),d(M,{class:"member-discount-info"},{default:t((()=>[u("会员享受9折优惠")])),_:1})])),_:1}),d(M,{class:"checkout-btn",onClick:o.handleCheckout},{default:t((()=>[u(" 结算("+f(o.selectedCount)+"件) ",1)])),_:1},8,["onClick"])],64))])),_:1})])),_:1})])),_:1})):(r(),e(M,{key:1,class:"empty-cart"},{default:t((()=>[d(y,{class:"empty-icon",src:"/static/images/empty-cart.png",mode:"aspectFit"}),d(C,{class:"empty-text"},{default:t((()=>[u("购物车还是空的")])),_:1}),d(M,{class:"go-shopping",onClick:o.goShopping},{default:t((()=>[u("去选购")])),_:1},8,["onClick"])])),_:1}))])),_:1})}],["__scopeId","data-v-b6d29261"]]);export{M as default};
