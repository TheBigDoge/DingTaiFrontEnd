import{a as e,e as t,f as s,g as a,n as l,h as c,i,d as o,j as n,c as r}from"./index-Clh3_Y42.js";import{a6 as d,ac as u,a7 as h,N as g,_ as f,aU as m,aV as _,aO as p,al as k,ai as L}from"./vendor.BqSpu6Cs.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const M=C({data:()=>({isManageMode:!1,cartList:[]}),computed:{isAllSelected(){return this.cartList.length>0&&this.cartList.every((e=>e.selected))},selectedCount(){return this.cartList.filter((e=>e.selected)).length},totalPrice(){return this.cartList.filter((e=>e.selected)).reduce(((e,t)=>e+t.unitPrice*t.length),0).toFixed(2)},discount(){const e=parseFloat(this.totalPrice);return e>=200?30*Math.floor(e/200):0}},onShow(){const e=c("cartList")||[];this.cartList=e.map((e=>({...e,selected:!1})))},methods:{toggleSelect(e){this.cartList[e].selected=!this.cartList[e].selected,this.saveCartList()},toggleSelectAll(){const e=!this.isAllSelected;this.cartList.forEach((t=>t.selected=e)),this.saveCartList()},decreaseLength(e){const t=this.cartList[e];t.length>.5?(t.length=parseFloat((t.length-.1).toFixed(1)),this.saveCartList()):s({title:"提示",content:"确定要删除该商品吗？",success:t=>{t.confirm&&(this.cartList.splice(e,1),this.saveCartList())}})},increaseLength(e){const t=this.cartList[e];t.length=parseFloat((t.length+.1).toFixed(1)),this.saveCartList()},handleCheckout(){const e=this.cartList.filter((e=>e.selected));if(0===e.length)return void a({title:"请选择要结算的商品",icon:"none"});const s={items:e.map((e=>({id:e.id,name:e.name,image:e.image,color:e.color,length:e.length,unitPrice:e.unitPrice,subtotal:e.length*e.unitPrice}))),totalAmount:e.reduce(((e,t)=>e+t.length*t.unitPrice),0),discount:this.discount,finalAmount:e.reduce(((e,t)=>e+t.length*t.unitPrice),0)-this.discount};try{t("currentOrder",s),l({url:"/pages/order/order",success:()=>{console.log("Navigation successful")},fail:e=>{console.error("Navigation failed:",e),a({title:"页面跳转失败",icon:"error"})}})}catch(c){console.error("处理订单失败:",c),a({title:"处理订单失败，请重试",icon:"error"})}},goShopping(){e({url:"/pages/index/index"})},toggleManageMode(){this.isManageMode=!this.isManageMode,this.isManageMode||(this.cartList.forEach((e=>e.selected=!1)),this.saveCartList())},handleDeleteSelected(){const e=this.cartList.filter((e=>e.selected));0!==e.length?s({title:"提示",content:`确定要删除选中的${e.length}件商品吗？`,success:e=>{e.confirm&&(this.cartList=this.cartList.filter((e=>!e.selected)),this.saveCartList(),0===this.cartList.length&&(this.isManageMode=!1))}}):a({title:"请选择要删除的商品",icon:"none"})},handleDeleteItem(e){s({title:"提示",content:"确定要删除该商品吗？",success:t=>{t.confirm&&(this.cartList.splice(e,1),this.saveCartList(),0===this.cartList.length&&(this.isManageMode=!1))}})},saveCartList(){t("cartList",this.cartList)},goToIndex(){e({url:"/pages/index/index"})},goToCategory(){e({url:"/pages/category/category"})},goToUser(){e({url:"/pages/user/user"})}}},[["render",function(e,t,s,a,l,c){const C=o,M=i,v=n,y=r;return h(),d(M,{class:"cart-page"},{default:u((()=>[g(M,{class:"page-header"},{default:u((()=>[g(M,{class:"header-title"},{default:u((()=>[f(" 购物车"),l.cartList.length>0?(h(),d(C,{key:0},{default:u((()=>[f("("+_(l.cartList.length)+")",1)])),_:1})):m("",!0)])),_:1}),g(M,{class:"header-right"},{default:u((()=>[g(C,{class:"manage-text",onClick:c.toggleManageMode},{default:u((()=>[f(_(l.isManageMode?"退出管理":"管理"),1)])),_:1},8,["onClick"])])),_:1})])),_:1}),l.cartList.length>0?(h(),d(M,{key:0,class:"cart-content"},{default:u((()=>[g(M,{class:"cart-list"},{default:u((()=>[(h(!0),p(k,null,L(l.cartList,((e,t)=>(h(),d(M,{class:"cart-item",key:t},{default:u((()=>[g(M,{class:"item-select"},{default:u((()=>[g(v,{checked:e.selected,color:"#333",onClick:e=>c.toggleSelect(t)},null,8,["checked","onClick"])])),_:2},1024),g(y,{class:"item-image",src:e.image,mode:"aspectFill"},null,8,["src"]),g(M,{class:"item-info"},{default:u((()=>[g(M,{class:"item-name text-ellipsis-2"},{default:u((()=>[f(_(e.name),1)])),_:2},1024),e.color?(h(),d(M,{key:0,class:"item-spec"},{default:u((()=>[f("颜色："+_(e.color),1)])),_:2},1024)):m("",!0),g(M,{class:"item-bottom"},{default:u((()=>[g(M,{class:"item-price"},{default:u((()=>[f("¥"+_(e.unitPrice)+"/m",1)])),_:2},1024),g(M,{class:"item-count"},{default:u((()=>[g(C,{class:"count-btn",onClick:e=>c.decreaseLength(t)},{default:u((()=>[f("-")])),_:2},1032,["onClick"]),g(C,{class:"count-num"},{default:u((()=>[f(_(e.length),1)])),_:2},1024),g(C,{class:"count-btn",onClick:e=>c.increaseLength(t)},{default:u((()=>[f("+")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024),l.isManageMode?(h(),d(M,{key:0,class:"delete-icon",onClick:e=>c.handleDeleteItem(t)},{default:u((()=>[g(C,{class:"iconfont icon-delete"},{default:u((()=>[f("×")])),_:1})])),_:2},1032,["onClick"])):m("",!0)])),_:2},1024)))),128))])),_:1}),g(M,{class:"promotion-section"},{default:u((()=>[g(M,{class:"promotion-item"},{default:u((()=>[g(C,{class:"tag"},{default:u((()=>[f("满减")])),_:1}),g(C,{class:"promo-text"},{default:u((()=>[f("每200减30")])),_:1})])),_:1})])),_:1}),g(M,{class:"cart-footer safe-area-bottom"},{default:u((()=>[g(M,{class:"footer-left"},{default:u((()=>[g(v,{checked:c.isAllSelected,color:"#333",onClick:c.toggleSelectAll},null,8,["checked","onClick"]),g(C,{class:"select-all"},{default:u((()=>[f("全选")])),_:1})])),_:1}),g(M,{class:"footer-right"},{default:u((()=>[l.isManageMode?(h(),d(M,{key:0,class:"delete-btn",onClick:c.handleDeleteSelected},{default:u((()=>[f("删除")])),_:1},8,["onClick"])):(h(),p(k,{key:1},[g(M,{class:"price-section"},{default:u((()=>[g(M,{class:"total-price"},{default:u((()=>[g(C,null,{default:u((()=>[f("合计：")])),_:1}),g(C,{class:"price"},{default:u((()=>[f("¥"+_(c.totalPrice),1)])),_:1})])),_:1}),c.discount>0?(h(),d(M,{key:0,class:"discount-info"},{default:u((()=>[f("已优惠：¥"+_(c.discount),1)])),_:1})):m("",!0)])),_:1}),g(M,{class:"checkout-btn",onClick:c.handleCheckout},{default:u((()=>[f(" 结算("+_(c.selectedCount)+"件) ",1)])),_:1},8,["onClick"])],64))])),_:1})])),_:1})])),_:1})):(h(),d(M,{key:1,class:"empty-cart"},{default:u((()=>[g(y,{class:"empty-icon",src:"./static/images/empty-cart.png",mode:"aspectFit"}),g(C,{class:"empty-text"},{default:u((()=>[f("购物车还是空的")])),_:1}),g(M,{class:"go-shopping",onClick:c.goShopping},{default:u((()=>[f("去选购")])),_:1},8,["onClick"])])),_:1})),g(M,{class:"bottom-nav safe-area-bottom"},{default:u((()=>[g(M,{class:"nav-item",onClick:c.goToIndex},{default:u((()=>[g(C,{class:"iconfont icon-home"},{default:u((()=>[f("首页")])),_:1})])),_:1},8,["onClick"]),g(M,{class:"nav-item",onClick:c.goToCategory},{default:u((()=>[g(C,{class:"iconfont icon-category"},{default:u((()=>[f("分类")])),_:1})])),_:1},8,["onClick"]),g(M,{class:"nav-item active"},{default:u((()=>[g(C,{class:"iconfont icon-cart"},{default:u((()=>[f("购物车")])),_:1})])),_:1}),g(M,{class:"nav-item",onClick:c.goToUser},{default:u((()=>[g(C,{class:"iconfont icon-user"},{default:u((()=>[f("我的")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-ca5602ff"]]);export{M as default};
