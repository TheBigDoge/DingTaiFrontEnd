import{c as e,w as s,A as t,B as a,u as l,m as d,z as i,C as o,q as r,n,$ as c,i as u,o as m,b as h,e as f,f as _,t as p,g,F as y,h as b,j as v,l as A,D as k,E as F}from"./index-Dz1Oxr08.js";import{_ as D}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=D({data:()=>({orderData:null,address:{name:"",phone:"",province:"",city:"",district:"",detail:"",isDefault:!1},orderItems:[],deliveryMethod:"快递配送",orderNote:"",shippingFee:0}),computed:{totalAmount(){return this.orderItems.reduce(((e,s)=>e+s.unitPrice*s.length),0)},discount(){return.1*this.totalAmount},finalAmount(){return this.totalAmount-this.discount+this.shippingFee}},onLoad(e){this.loadDefaultAddress(),this.loadOrderItems()},onShow(){this.loadDefaultAddress()},onHide(){c("addressSelected")},methods:{loadDefaultAddress(){let e=l("selectedAddress");if(e)return void(this.address=e);const s=l("addressList")||[],t=s.find((e=>e.isDefault));t?this.address=t:s.length>0&&(this.address=s[0])},loadOrderItems(){try{const e=l("currentOrder");e&&(this.orderItems=e.items)}catch(e){console.error("加载订单数据失败:",e),r({title:"加载订单失败",icon:"error"})}},changeAddress(){n({url:"/pages/address/address",success:()=>{console.log("Navigation to address page successful")},fail:e=>{console.error("Navigation to address page failed:",e),r({title:"页面跳转失败",icon:"error"})}})},updateQuantity(e,s){const t=this.orderItems[e];if(t.isWholePiece)return;const a=parseFloat((t.length+s).toFixed(1));a>=.85&&(t.length=a)},toggleWholePiece(e){const s=this.orderItems[e];s.isWholePiece=!s.isWholePiece,s.isWholePiece?s.length=10:s.length=2},selectDelivery(e){this.deliveryMethod=e},submitOrder(){this.address.name&&this.address.phone&&this.address.detail?0!==this.orderItems.length?(this.orderItems,this.address,this.orderNote,this.deliveryMethod,this.totalAmount,this.discount,this.finalAmount,(new Date).toISOString(),t({title:"提交中..."}),setTimeout((()=>{a(),r({title:"下单成功",icon:"success",duration:2e3,success:()=>{setTimeout((()=>{this.handleSubmitOrder()}),1500)}})}),1500)):r({title:"请选择商品",icon:"none"}):r({title:"请选择收货地址",icon:"none"})},handleSubmitOrder(){t({title:"提交订单中..."}),setTimeout((()=>{a();const e=l("cartList")||[],s=l("currentOrder"),t=s.items.map((e=>e.id)),r=e.filter((e=>!t.includes(e.id)));d("cartList",r);const n={orderNo:"DT"+(new Date).getTime(),status:"pending",items:s.items,totalAmount:this.totalAmount,discount:this.discount,shippingFee:this.shippingFee,finalAmount:this.finalAmount,orderTime:(new Date).toISOString()},c=l("orderList")||[];c.unshift(n),d("orderList",c),i("currentOrder"),o({url:`/pages/order/success?orderNo=${n.orderNo}`})}),1500)}}},[["render",function(t,a,l,d,i,o){const r=f,n=u,c=v,D=k,x=F;return m(),e(n,{class:"order-page"},{default:s((()=>[h(n,{class:"header"},{default:s((()=>[h(r,{class:"header-title"},{default:s((()=>[_("确认订单")])),_:1})])),_:1}),h(n,{class:"address-section",onClick:o.changeAddress},{default:s((()=>[i.address.name?(m(),e(n,{key:0,class:"address-info"},{default:s((()=>[h(n,{class:"address-name"},{default:s((()=>[_(p(i.address.name)+" "+p(i.address.phone),1)])),_:1}),h(n,{class:"address-detail"},{default:s((()=>[_(p(i.address.province)+p(i.address.city)+p(i.address.district)+p(i.address.detail),1)])),_:1})])),_:1})):(m(),e(n,{key:1,class:"no-address"},{default:s((()=>[h(r,{class:"no-address-text"},{default:s((()=>[_("请选择收货地址")])),_:1})])),_:1})),h(n,{class:"change-address"},{default:s((()=>[_("更换地址")])),_:1})])),_:1},8,["onClick"]),h(n,{class:"items-section"},{default:s((()=>[(m(!0),g(y,null,b(i.orderItems,((t,a)=>(m(),e(n,{class:"item",key:a},{default:s((()=>[h(c,{src:t.image,mode:"aspectFill",class:"item-image"},null,8,["src"]),h(n,{class:"item-info"},{default:s((()=>[h(n,{class:"item-title"},{default:s((()=>[_(p(t.name),1)])),_:2},1024),h(n,{class:"item-price"},{default:s((()=>[h(r,{class:"member-price"},{default:s((()=>[_("¥"+p((.9*t.unitPrice).toFixed(2)),1)])),_:2},1024),h(r,{class:"original-price"},{default:s((()=>[_("¥"+p(t.unitPrice.toFixed(2)),1)])),_:2},1024)])),_:2},1024),h(n,{class:"item-details"},{default:s((()=>[h(n,{class:"item-size"},{default:s((()=>[_("规格："+p(t.length)+"米",1)])),_:2},1024),h(n,{class:A(["quantity-control",{disabled:t.isWholePiece}])},{default:s((()=>[h(r,{class:A(["quantity-btn",{disabled:t.isWholePiece}]),onClick:e=>o.updateQuantity(a,-.1)},{default:s((()=>[_("-")])),_:2},1032,["onClick","class"]),h(r,{class:"quantity"},{default:s((()=>[_(p(t.length),1)])),_:2},1024),h(r,{class:A(["quantity-btn",{disabled:t.isWholePiece}]),onClick:e=>o.updateQuantity(a,.1)},{default:s((()=>[_("+")])),_:2},1032,["onClick","class"])])),_:2},1032,["class"]),h(n,{class:"buy-whole-container"},{default:s((()=>[h(n,{class:A(["buy-whole-btn",{active:t.isWholePiece}]),onClick:e=>o.toggleWholePiece(a)},{default:s((()=>[h(r,{class:"btn-text"},{default:s((()=>[_("整块购买")])),_:1})])),_:2},1032,["class","onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),h(n,{class:"delivery-section"},{default:s((()=>[h(n,{class:"section-title"},{default:s((()=>[_("配送方式")])),_:1}),h(n,{class:"delivery-options"},{default:s((()=>[h(n,{class:A(["delivery-option",{selected:"快递配送"===i.deliveryMethod}]),onClick:a[0]||(a[0]=e=>o.selectDelivery("快递配送"))},{default:s((()=>[_("快递配送")])),_:1},8,["class"]),h(n,{class:A(["delivery-option",{selected:"到店自提"===i.deliveryMethod}]),onClick:a[1]||(a[1]=e=>o.selectDelivery("到店自提"))},{default:s((()=>[_("到店自提")])),_:1},8,["class"])])),_:1})])),_:1}),h(n,{class:"memo-section"},{default:s((()=>[h(n,{class:"section-title"},{default:s((()=>[_("商品备注")])),_:1}),h(D,{class:"memo-input",modelValue:i.orderNote,"onUpdate:modelValue":a[2]||(a[2]=e=>i.orderNote=e),placeholder:"请输入备注信息（选填）",maxlength:"200","show-count":!1},null,8,["modelValue"]),h(n,{class:"memo-count"},{default:s((()=>[_(p(i.orderNote.length)+"/200",1)])),_:1})])),_:1}),h(n,{class:"bottom-container"},{default:s((()=>[h(n,{class:"order-summary"},{default:s((()=>[h(n,{class:"summary-item"},{default:s((()=>[h(r,null,{default:s((()=>[_("商品总额")])),_:1}),h(r,null,{default:s((()=>[_("¥"+p(o.totalAmount.toFixed(2)),1)])),_:1})])),_:1}),h(n,{class:"summary-item"},{default:s((()=>[h(r,null,{default:s((()=>[_("运费")])),_:1}),h(r,null,{default:s((()=>[_("¥"+p(i.shippingFee.toFixed(2)),1)])),_:1})])),_:1}),h(n,{class:"summary-item"},{default:s((()=>[h(r,null,{default:s((()=>[_("会员优惠")])),_:1}),h(r,null,{default:s((()=>[_("-¥"+p(o.discount.toFixed(2)),1)])),_:1})])),_:1}),h(n,{class:"summary-total"},{default:s((()=>[h(r,null,{default:s((()=>[_("实付金额")])),_:1}),h(r,null,{default:s((()=>[_("¥"+p(o.finalAmount.toFixed(2)),1)])),_:1})])),_:1}),h(n,{class:"discount-notice"},{default:s((()=>[_("会员享受9折优惠")])),_:1})])),_:1}),h(x,{class:A(["submit-btn safe-area-bottom",{disabled:!i.address.name}]),onClick:o.submitOrder},{default:s((()=>[_("提交订单")])),_:1},8,["class","onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-2af5fc3f"]]);export{x as default};
