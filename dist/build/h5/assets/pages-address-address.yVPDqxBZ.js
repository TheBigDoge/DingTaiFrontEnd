import{g as a,u as t,v as e,w as s,x as l,f as i,e as o,h as d,i as n,d as c,c as r,I as u,y as f,q as m,z as h,t as p}from"./index-Clh3_Y42.js";import{a6 as _,ac as D,aT as g,a7 as L,N as k,_ as y,aO as v,al as C,ai as b,aU as w,aV as V}from"./vendor.BqSpu6Cs.js";import{_ as F}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=F({data:()=>({addressList:[],isEdit:!1,editIndex:-1,map:null,marker:null,searchKeyword:"",searchResults:[],manualLatitude:"",manualLongitude:"",formData:{name:"",phone:"",province:"",city:"",district:"",detail:"",isDefault:!1,latitude:"",longitude:"",locationName:""}}),onShow(){this.loadAddressList()},methods:{loadAddressList(){const a=d("addressList")||[];this.addressList=a},showAddressForm(){this.isEdit=!1,this.editIndex=-1,this.formData={name:"",phone:"",province:"",city:"",district:"",detail:"",isDefault:!1,latitude:"",longitude:"",locationName:""},this.$refs.addressForm.open()},editAddress(a,t){this.isEdit=!0,this.editIndex=t,this.formData={...a},this.$refs.addressForm.open()},closeForm(){this.$refs.addressForm.close()},handleRegionChange(a){const[t,e,s]=a.detail.value;this.formData.province=t,this.formData.city=e,this.formData.district=s},handleDefaultChange(a){this.formData.isDefault=a.detail.value},validateForm(){return this.formData.name?this.formData.phone&&/^1\d{10}$/.test(this.formData.phone)?this.formData.province&&this.formData.city&&this.formData.district?!!this.formData.detail||(a({title:"请输入详细地址",icon:"none"}),!1):(a({title:"请选择所在地区",icon:"none"}),!1):(a({title:"请输入正确的手机号码",icon:"none"}),!1):(a({title:"请输入收货人姓名",icon:"none"}),!1)},saveAddress(){this.validateForm()&&(this.formData.isDefault&&this.addressList.forEach((a=>a.isDefault=!1)),this.isEdit?this.addressList[this.editIndex]={...this.formData}:this.addressList.push({...this.formData}),1===this.addressList.length&&(this.addressList[0].isDefault=!0),o("addressList",this.addressList),a({title:this.isEdit?"地址修改成功":"地址添加成功",icon:"success"}),this.closeForm())},deleteAddress(t){i({title:"提示",content:"确定要删除该地址吗？",success:e=>{if(e.confirm){const e=this.addressList[t].isDefault;this.addressList.splice(t,1),e&&this.addressList.length>0&&(this.addressList[0].isDefault=!0),o("addressList",this.addressList),a({title:"删除成功",icon:"success"})}}})},selectAddress(a){const t=e(),i=t[t.length-2];i&&i.route.includes("order")&&(s("addressSelected",a),l())},showLocationPicker(){this.$refs.locationPicker.open()},closeLocationPicker(){this.$refs.locationPicker.close()},getCurrentLocation(){t({type:"gcj02",success:a=>{this.formData.latitude=a.latitude,this.formData.longitude=a.longitude,this.manualLatitude=a.latitude,this.manualLongitude=a.longitude,this.getLocationName(a.latitude,a.longitude)},fail:()=>{a({title:"获取位置失败",icon:"none"})}})},async getLocationName(a,t){try{const e=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${a}&lon=${t}&zoom=18&addressdetails=1`),s=await e.json();if(s.address){const a=s.address;this.formData.locationName=s.display_name,this.formData.province=a.state||a.province||"",this.formData.city=a.city||a.town||"",this.formData.district=a.county||a.district||""}}catch(e){console.error("Error getting location name:",e)}},confirmLocation(){this.manualLatitude&&this.manualLongitude&&(this.formData.latitude=parseFloat(this.manualLatitude),this.formData.longitude=parseFloat(this.manualLongitude),this.getLocationName(this.formData.latitude,this.formData.longitude)),this.formData.latitude&&this.formData.longitude?this.closeLocationPicker():a({title:"请选择位置",icon:"none"})}}},[["render",function(a,t,e,s,l,i){const o=c,d=n,F=r,x=u,A=f,$=m,N=h,E=p,P=g("uni-popup");return L(),_(d,{class:"address-page"},{default:D((()=>[k(d,{class:"page-header"},{default:D((()=>[k(o,{class:"header-title"},{default:D((()=>[y("收货地址")])),_:1})])),_:1}),l.addressList.length>0?(L(),_(d,{key:0,class:"address-list"},{default:D((()=>[(L(!0),v(C,null,b(l.addressList,((a,t)=>(L(),_(d,{class:"address-item",key:t},{default:D((()=>[k(d,{class:"address-info",onClick:t=>i.selectAddress(a)},{default:D((()=>[k(d,{class:"user-info"},{default:D((()=>[k(o,{class:"name"},{default:D((()=>[y(V(a.name),1)])),_:2},1024),k(o,{class:"phone"},{default:D((()=>[y(V(a.phone),1)])),_:2},1024),a.isDefault?(L(),_(o,{key:0,class:"default-tag"},{default:D((()=>[y("默认")])),_:1})):w("",!0)])),_:2},1024),k(d,{class:"address-detail"},{default:D((()=>[y(V(a.province)+V(a.city)+V(a.district)+V(a.detail),1)])),_:2},1024)])),_:2},1032,["onClick"]),k(d,{class:"address-actions"},{default:D((()=>[k(d,{class:"action-item",onClick:e=>i.editAddress(a,t)},{default:D((()=>[k(o,{class:"iconfont"},{default:D((()=>[y("✎")])),_:1}),k(o,null,{default:D((()=>[y("编辑")])),_:1})])),_:2},1032,["onClick"]),k(d,{class:"action-item",onClick:a=>i.deleteAddress(t)},{default:D((()=>[k(o,{class:"iconfont"},{default:D((()=>[y("×")])),_:1}),k(o,null,{default:D((()=>[y("删除")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})):(L(),_(d,{key:1,class:"empty-state"},{default:D((()=>[k(F,{class:"empty-icon",src:"./static/images/empty-address.png",mode:"aspectFit"}),k(o,{class:"empty-text"},{default:D((()=>[y("暂无收货地址")])),_:1})])),_:1})),k(d,{class:"add-address safe-area-bottom",onClick:i.showAddressForm},{default:D((()=>[k(o,{class:"iconfont"},{default:D((()=>[y("+")])),_:1}),k(o,null,{default:D((()=>[y("新增收货地址")])),_:1})])),_:1},8,["onClick"]),k(P,{ref:"addressForm",type:"bottom"},{default:D((()=>[k(d,{class:"form-popup"},{default:D((()=>[k(d,{class:"form-header"},{default:D((()=>[k(o,{class:"title"},{default:D((()=>[y(V(l.isEdit?"编辑地址":"新增地址"),1)])),_:1}),k(o,{class:"close",onClick:i.closeForm},{default:D((()=>[y("×")])),_:1},8,["onClick"])])),_:1}),k(d,{class:"form-content"},{default:D((()=>[k(d,{class:"form-item"},{default:D((()=>[k(o,{class:"label"},{default:D((()=>[y("收货人")])),_:1}),k(x,{type:"text",modelValue:l.formData.name,"onUpdate:modelValue":t[0]||(t[0]=a=>l.formData.name=a),placeholder:"请输入收货人姓名"},null,8,["modelValue"])])),_:1}),k(d,{class:"form-item"},{default:D((()=>[k(o,{class:"label"},{default:D((()=>[y("手机号码")])),_:1}),k(x,{type:"number",modelValue:l.formData.phone,"onUpdate:modelValue":t[1]||(t[1]=a=>l.formData.phone=a),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])])),_:1}),k(d,{class:"form-item"},{default:D((()=>[k(o,{class:"label"},{default:D((()=>[y("所在地区")])),_:1}),k(A,{mode:"region",onChange:i.handleRegionChange,value:[l.formData.province,l.formData.city,l.formData.district]},{default:D((()=>[k(d,{class:"picker-value"},{default:D((()=>[y(V(l.formData.province||l.formData.city||l.formData.district?`${l.formData.province} ${l.formData.city} ${l.formData.district}`:"请选择所在地区"),1)])),_:1})])),_:1},8,["onChange","value"])])),_:1}),k(d,{class:"form-item"},{default:D((()=>[k(o,{class:"label"},{default:D((()=>[y("在地图上选择位置")])),_:1}),k(d,{class:"map-container",onClick:i.showLocationPicker},{default:D((()=>[l.formData.latitude?(L(),_(d,{key:1,class:"selected-location"},{default:D((()=>[k(o,{class:"location-text"},{default:D((()=>[y("已选择位置")])),_:1}),k(o,{class:"coordinates"},{default:D((()=>[y(V(l.formData.latitude)+", "+V(l.formData.longitude),1)])),_:1})])),_:1})):(L(),_(d,{key:0,class:"map-placeholder"},{default:D((()=>[k(o,{class:"iconfont"},{default:D((()=>[y("📍")])),_:1}),k(o,null,{default:D((()=>[y("点击选择位置")])),_:1})])),_:1}))])),_:1},8,["onClick"])])),_:1}),k(d,{class:"form-item"},{default:D((()=>[k(o,{class:"label"},{default:D((()=>[y("详细地址")])),_:1}),k($,{modelValue:l.formData.detail,"onUpdate:modelValue":t[2]||(t[2]=a=>l.formData.detail=a),placeholder:"请输入详细地址，如街道、门牌号等"},null,8,["modelValue"])])),_:1}),k(d,{class:"form-item switch-item"},{default:D((()=>[k(o,{class:"label"},{default:D((()=>[y("设为默认地址")])),_:1}),k(N,{checked:l.formData.isDefault,onChange:i.handleDefaultChange,color:"#333"},null,8,["checked","onChange"])])),_:1})])),_:1}),k(d,{class:"form-footer"},{default:D((()=>[k(E,{class:"submit-btn",onClick:i.saveAddress},{default:D((()=>[y("保存")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},512),k(P,{ref:"locationPicker",type:"bottom"},{default:D((()=>[k(d,{class:"location-popup"},{default:D((()=>[k(d,{class:"location-header"},{default:D((()=>[k(o,{class:"title"},{default:D((()=>[y("选择位置")])),_:1}),k(o,{class:"close",onClick:i.closeLocationPicker},{default:D((()=>[y("×")])),_:1},8,["onClick"])])),_:1}),k(d,{class:"location-content"},{default:D((()=>[k(d,{class:"location-options"},{default:D((()=>[k(E,{class:"location-btn",onClick:i.getCurrentLocation},{default:D((()=>[k(o,{class:"iconfont"},{default:D((()=>[y("📍")])),_:1}),k(o,null,{default:D((()=>[y("使用当前位置")])),_:1})])),_:1},8,["onClick"]),k(d,{class:"manual-input"},{default:D((()=>[k(o,{class:"input-label"},{default:D((()=>[y("或手动输入坐标")])),_:1}),k(d,{class:"input-group"},{default:D((()=>[k(x,{type:"number",modelValue:l.manualLatitude,"onUpdate:modelValue":t[3]||(t[3]=a=>l.manualLatitude=a),placeholder:"纬度"},null,8,["modelValue"]),k(x,{type:"number",modelValue:l.manualLongitude,"onUpdate:modelValue":t[4]||(t[4]=a=>l.manualLongitude=a),placeholder:"经度"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),l.formData.latitude?(L(),_(d,{key:0,class:"location-preview"},{default:D((()=>[k(o,{class:"preview-title"},{default:D((()=>[y("当前位置信息")])),_:1}),k(d,{class:"preview-info"},{default:D((()=>[k(o,{class:"info-label"},{default:D((()=>[y("纬度：")])),_:1}),k(o,{class:"info-value"},{default:D((()=>[y(V(l.formData.latitude),1)])),_:1})])),_:1}),k(d,{class:"preview-info"},{default:D((()=>[k(o,{class:"info-label"},{default:D((()=>[y("经度：")])),_:1}),k(o,{class:"info-value"},{default:D((()=>[y(V(l.formData.longitude),1)])),_:1})])),_:1}),l.formData.locationName?(L(),_(d,{key:0,class:"preview-info"},{default:D((()=>[k(o,{class:"info-label"},{default:D((()=>[y("地址：")])),_:1}),k(o,{class:"info-value"},{default:D((()=>[y(V(l.formData.locationName),1)])),_:1})])),_:1})):w("",!0)])),_:1})):w("",!0)])),_:1}),k(d,{class:"location-footer"},{default:D((()=>[k(E,{class:"confirm-btn",onClick:i.confirmLocation},{default:D((()=>[y("确认位置")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},512)])),_:1})}],["__scopeId","data-v-f69fa9d7"]]);export{x as default};
