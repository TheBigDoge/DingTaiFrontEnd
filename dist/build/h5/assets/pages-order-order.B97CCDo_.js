import{c as e,w as t,A as s,B as a,q as d,l,z as i,C as r,p as o,n,$ as u,i as c,o as m,b as f,e as h,f as _,t as p,g,F as y,h as v,j as A,x as F,D as b,E as D}from"./index-oiMriBxI.js";import{_ as k}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=k({data:()=>({orderData:null,address:{name:"",phone:"",province:"",city:"",district:"",detail:"",isDefault:!1},orderItems:[],deliveryMethod:"快递配送",orderNote:"",shippingFee:0}),computed:{totalAmount(){return this.orderItems.reduce(((e,t)=>e+t.unitPrice*t.length),0)},discount(){return.1*this.totalAmount},finalAmount(){return this.totalAmount-this.discount+this.shippingFee}},onLoad(e){this.loadDefaultAddress(),this.loadOrderItems()},onShow(){this.loadDefaultAddress()},onHide(){u("addressSelected")},methods:{loadDefaultAddress(){let e=d("selectedAddress");if(e)return void(this.address=e);const t=d("addressList")||[],s=t.find((e=>e.isDefault));s?this.address=s:t.length>0&&(this.address=t[0])},loadOrderItems(){try{const e=d("currentOrder");e&&(this.orderItems=e.items)}catch(e){console.error("加载订单数据失败:",e),o({title:"加载订单失败",icon:"error"})}},changeAddress(){n({url:"/pages/address/address",success:()=>{console.log("Navigation to address page successful")},fail:e=>{console.error("Navigation to address page failed:",e),o({title:"页面跳转失败",icon:"error"})}})},updateQuantity(e,t){const s=this.orderItems[e],a=parseFloat((s.length+t).toFixed(1));a>=.5&&(s.length=a)},selectDelivery(e){this.deliveryMethod=e},submitOrder(){this.address.name&&this.address.phone&&this.address.detail?0!==this.orderItems.length?(this.orderItems,this.address,this.orderNote,this.deliveryMethod,this.totalAmount,this.discount,this.finalAmount,(new Date).toISOString(),s({title:"提交中..."}),setTimeout((()=>{a(),o({title:"下单成功",icon:"success",duration:2e3,success:()=>{setTimeout((()=>{this.handleSubmitOrder()}),1500)}})}),1500)):o({title:"请选择商品",icon:"none"}):o({title:"请选择收货地址",icon:"none"})},handleSubmitOrder(){s({title:"提交订单中..."}),setTimeout((()=>{a();const e=d("cartList")||[],t=d("currentOrder"),s=t.items.map((e=>e.id)),o=e.filter((e=>!s.includes(e.id)));l("cartList",o);const n={orderNo:"DT"+(new Date).getTime(),status:"pending",items:t.items,totalAmount:this.totalAmount,discount:this.discount,shippingFee:this.shippingFee,finalAmount:this.finalAmount,orderTime:(new Date).toISOString()},u=d("orderList")||[];u.unshift(n),l("orderList",u),i("currentOrder"),r({url:`/pages/order/success?orderNo=${n.orderNo}`})}),1500)}}},[["render",function(s,a,d,l,i,r){const o=h,n=c,u=A,k=b,x=D;return m(),e(n,{class:"order-page"},{default:t((()=>[f(n,{class:"header"},{default:t((()=>[f(o,{class:"header-title"},{default:t((()=>[_("确认订单")])),_:1})])),_:1}),f(n,{class:"address-section",onClick:r.changeAddress},{default:t((()=>[i.address.name?(m(),e(n,{key:0,class:"address-info"},{default:t((()=>[f(n,{class:"address-name"},{default:t((()=>[_(p(i.address.name)+" "+p(i.address.phone),1)])),_:1}),f(n,{class:"address-detail"},{default:t((()=>[_(p(i.address.province)+p(i.address.city)+p(i.address.district)+p(i.address.detail),1)])),_:1})])),_:1})):(m(),e(n,{key:1,class:"no-address"},{default:t((()=>[f(o,{class:"no-address-text"},{default:t((()=>[_("请选择收货地址")])),_:1})])),_:1})),f(n,{class:"change-address"},{default:t((()=>[_("更换地址")])),_:1})])),_:1},8,["onClick"]),f(n,{class:"items-section"},{default:t((()=>[(m(!0),g(y,null,v(i.orderItems,((s,a)=>(m(),e(n,{class:"item",key:a},{default:t((()=>[f(u,{src:s.image,mode:"aspectFill",class:"item-image"},null,8,["src"]),f(n,{class:"item-info"},{default:t((()=>[f(n,{class:"item-title"},{default:t((()=>[_(p(s.name),1)])),_:2},1024),f(n,{class:"item-price"},{default:t((()=>[f(o,{class:"member-price"},{default:t((()=>[_("¥"+p((.9*s.unitPrice).toFixed(2)),1)])),_:2},1024),f(o,{class:"original-price"},{default:t((()=>[_("¥"+p(s.unitPrice.toFixed(2)),1)])),_:2},1024)])),_:2},1024),f(n,{class:"item-details"},{default:t((()=>[f(n,{class:"item-size"},{default:t((()=>[_("规格："+p(s.length)+"米",1)])),_:2},1024),f(n,{class:"quantity-control"},{default:t((()=>[f(o,{class:"quantity-btn",onClick:e=>r.updateQuantity(a,-.1)},{default:t((()=>[_("-")])),_:2},1032,["onClick"]),f(o,{class:"quantity"},{default:t((()=>[_(p(s.length),1)])),_:2},1024),f(o,{class:"quantity-btn",onClick:e=>r.updateQuantity(a,.1)},{default:t((()=>[_("+")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),f(n,{class:"delivery-section"},{default:t((()=>[f(n,{class:"section-title"},{default:t((()=>[_("配送方式")])),_:1}),f(n,{class:"delivery-options"},{default:t((()=>[f(n,{class:F(["delivery-option",{selected:"快递配送"===i.deliveryMethod}]),onClick:a[0]||(a[0]=e=>r.selectDelivery("快递配送"))},{default:t((()=>[_("快递配送")])),_:1},8,["class"]),f(n,{class:F(["delivery-option",{selected:"到店自提"===i.deliveryMethod}]),onClick:a[1]||(a[1]=e=>r.selectDelivery("到店自提"))},{default:t((()=>[_("到店自提")])),_:1},8,["class"])])),_:1})])),_:1}),f(n,{class:"memo-section"},{default:t((()=>[f(n,{class:"section-title"},{default:t((()=>[_("商品备注")])),_:1}),f(k,{class:"memo-input",modelValue:i.orderNote,"onUpdate:modelValue":a[2]||(a[2]=e=>i.orderNote=e),placeholder:"请输入备注信息（选填）",maxlength:"200","show-count":!1},null,8,["modelValue"]),f(n,{class:"memo-count"},{default:t((()=>[_(p(i.orderNote.length)+"/200",1)])),_:1})])),_:1}),f(n,{class:"bottom-container"},{default:t((()=>[f(n,{class:"order-summary"},{default:t((()=>[f(n,{class:"summary-item"},{default:t((()=>[f(o,null,{default:t((()=>[_("商品总额")])),_:1}),f(o,null,{default:t((()=>[_("¥"+p(r.totalAmount.toFixed(2)),1)])),_:1})])),_:1}),f(n,{class:"summary-item"},{default:t((()=>[f(o,null,{default:t((()=>[_("运费")])),_:1}),f(o,null,{default:t((()=>[_("¥"+p(i.shippingFee.toFixed(2)),1)])),_:1})])),_:1}),f(n,{class:"summary-item"},{default:t((()=>[f(o,null,{default:t((()=>[_("会员优惠")])),_:1}),f(o,null,{default:t((()=>[_("-¥"+p(r.discount.toFixed(2)),1)])),_:1})])),_:1}),f(n,{class:"summary-total"},{default:t((()=>[f(o,null,{default:t((()=>[_("实付金额")])),_:1}),f(o,null,{default:t((()=>[_("¥"+p(r.finalAmount.toFixed(2)),1)])),_:1})])),_:1}),f(n,{class:"discount-notice"},{default:t((()=>[_("会员享受9折优惠")])),_:1})])),_:1}),f(x,{class:F(["submit-btn safe-area-bottom",{disabled:!i.address.name}]),onClick:r.submitOrder},{default:t((()=>[_("提交订单")])),_:1},8,["class","onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-4b92ce76"]]);export{x as default};
